<!DOCTYPE html>
<html>
  <head>
    <title>Basic Three.js App</title>
    <style>
      html, body { margin: 0; padding: 0; overflow: hidden; }
      #GL > canvas { height: 100%; width: 100%; }
      canvas#debugCanvas { height: 100%; width: 100%; }
    </style>
  </head>
  <body>
    <div id="GL" style="width: 300px; height: 300px; image-rendering: pixelated;"></div>
    <div id="dbCanvasContainer" style="width: 300px; height: 300px; image-rendering: pixelated;">
      <canvas id="debugCanvas">
    </div>
    <script id="post-vert" type="x-shader/x-vertex">
      varying vec2 vUv;
      varying vec4 vVector;
      uniform float cameraNear;
      uniform float cameraFar;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        vVector = vec4(gl_Position.xyz, 1.0);
        vVector = vec4(position,1.0);
        //vVector.z = vVector.z - cameraNear;
        //vVector.z = vVector.z / cameraFar;
      }
    </script>
    <script id="post-frag" type="x-shader/x-fragment">
      #include <packing>
      varying vec2 vUv;
      varying vec4 vVector;
      uniform sampler2D tDiffuse;
      uniform sampler2D tDepth;
      uniform float cameraNear;
      uniform float cameraFar;
      float readDepth (sampler2D depthSampler, vec2 coord) {
        float fragCoordZ = texture2D(depthSampler, coord).x;
        float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
        return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
      }
      void main() {
        vec3 diffuse = texture2D(tDiffuse, vUv).rgb;
        float depth = readDepth(tDepth, vUv);
        //depth = texture2D(tDepth, vUv).x;
        gl_FragColor.rgb = vec3(vUv.x,vUv.y,depth);
        gl_FragColor.a = 0.0 ;
      }
    </script>
    <script src="js/three.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/main-script.js"></script>
  </body>
</html>